{
    "poll_list": [],
    "discourse_list": [
        {
            "thread_link": "https://forum.makerdao.com/t/starknet-wormhole-implementation-details/12042",
            "title": "Starknet wormhole implementation details ",
            "index": 12042,
            "category": [
                "Core Units",
                "StarkNet Engineering"
            ],
            "tags": [
                "sne-001"
            ],
            "content": [
                {
                    "author_link": "https://forum.makerdao.com/u/pyramidmaker",
                    "index": "#1",
                    "likes": "8",
                    "time": "07/12/2021-12:58:39",
                    "content": " References  Maker Multichain strategy Introduction to Wormhole design   MiP39c2 - sp19: Adding the Starknet Engineering Core Unit (SECU) Maker <> Starknet bridge repo  Maker <> Starknet bridge audit report  MIP40c3: Starknet wormhole implementation   Sentence summary This post provides references to the deliverables of phase I work (github, audit)  and more context to the subproposal MIP40c3 which proposes a budget extension for the Starknet Engineering core unit to implement on Starknet the wormhole design put forward by the PECU. It includes building the necessary components to enable the L2->L1 fast withdrawal and the L2 <> L2 teleportation; we plan for a delivery respectively in April and July 2022.  Introduction PECU\u2019s post in May opened the discussion about the role of Maker in a complex and fastly growing multi-chain ecosystem. As Ethereum gas fees are becoming prohibitive for a large number of use cases on Ethereum, users are pushed to use L2 and other scaling solutions, hence making it a priority for DAI to be easily accessible and usable on those chains. In parallel, user experience in the multi-chain ecosystem is still immature, particularly when it comes to moving funds around the ecosystem across domains. The wormhole design lays out a design that would facilitate moving DAI across domains, and potentially making DAI the easiest token to transfer across domains. The wormhole design introduces two main user workflows: L2->L1 fast withdrawals, and L2 \u2192 L2 wormhole (also called teleportation). PECU has been designing the components for the L2->L1 fast withdrawals for an expected delivery in Q1, and the components for the teleportation for an expected delivery in Q2. In this context, SECU already built the bridge which is a key component of those designs. The bridge audit report should be available by mid-December. The Starknet Engineering CU is asking for a budget extension (MIP40c3) to build the fast withdrawal and the wormhole in parallel, for a delivery timeline aligned (or slightly behind) with that of PECU, i.e., around April and July 2022 respectively.  Motivation  Why do we want to expand the Maker protocol behind Ethereum? Gas fees have been exceptionally high lately, increasing more than 20x between June and October 2021, hence putting a lot of pressure on users to migrate to other domains (L2 or cheaper L1s). As users are expected to use new domains more and more, it is crucial for Maker to establish footholds on these platforms - in order to keep DAI highly usable and interchangeable among them. Furthermore, operating on a scaled and fast environment comes with its own set of unique opportunities.  Reducing costs and increasing speed for certain modules, allowing to rethink the logic of some components of the module (e.g., Oracle, Liquidation) Increasing the collateral types available. In the past year, Maker had to off-board a number of collateral types for profitability reasons. The cost of operating was exceeding the revenues yielded by the collateral type. In a cheaper environment, there is an opportunity for Maker to make those collaterals profitable as well as on-board L2 native tokens as collateral   Leveraging Maker\u2019s strength to make DAI more attractive While competing lending protocols have rushed to build pools onto cheaper domains, Maker has been taking a slower approach to develop the wormhole design that leverages Maker\u2019s unique position to make DAI the most used stable coin across the ecosystem. This constitutes a preliminary step before allowing users to mint against collateral on new domains. The wormhole design proposed by PECU leverages Maker\u2019s battle-tested oracles as well as its ability to mint DAI to facilitate the user experience of moving DAI around the ecosystem. Solutions like the Hop protocol are using a combination of bridges and AMMs. Not relying on AMMs means more reliability and predictability, and less fees. Using oracles allows for teleportation, which means almost instant availabiilty of DAI on the target domain.  What does it mean to expand Maker For DAI to become the fungible token to facilitate liquidity flows and trade in and across ecosystem, the following conditions need to hold true:  It must be possible to transfer DAI between L1 and L2 without multiple version of DAI (DAI bridge) It must be possible to withdraw funds from L2 to L1 quickly (Fast withdrawals) It must be possible to use and transfer DAI across multiple L2s (DAI wormhole) It must be possible to mint DAI using L2 collateral type (MCD on L2) It must be possible to do all of the above within accepted risk/securities boundaries (Risk assessment)  Currently, the PECU, Oracles CU, and SECU are focused on enabling the fast withdrawals and the wormhole.  Wormhole design The intent of this section is to provide all the readers a high-level understanding of the wormhole design, it is combining information from the post \u201cIntroducing Maker Wormhole\u201d as well as discussions with PECU and internal design documents. It is not a holistic description of the design and all the edge cases. Technical readers who are familiar with the matter can skip to the next section. The purpose of the wormhole design is to enable DAI fast withdrawals to L1 and teleportation from source domain to target domain. Domain in this context can designate a L2, a sidechain, or a L1. In the regular case, withdrawal delay can be one week for Optimistic rollups, down to 3 to 8 hours for zk-rollups like Starknet. The wormhole design can make those in minutes. You will find below a quick summary of the fast path (happy flows).  L2 \u2192 L1 Fast withdrawals Walking through the fast path of the fast withdrawal workflow in the wormhole design:  User submits a fast withdrawal request to the L2 DAI bridge (initiateWormhole) to withdraw 100 DAI. DAI on L2 is burnt User gets an attestation that they burnt DAI and requested a fast withdrawal to L1 (off-chain oracle) User provides attestation to WormholeOracleAuth contract on L1 that verifies that their attestation is correctly signed by the Maker Oracle Feed. User mints 100 DAI on L1 from WormholeJoin as long as the wormhole debt ceiling is not reached, the debt outstanding to be repaid is 100 DAI  Periodically, a keeper calls Flush on L2 DAI bridge which sends a L2->L1 message to release the DAI from the L1 bridge contract and pay back the 100 DAI debt. In the case where the Oracle Network is not available for any reason, the user can go through the slow path by calling the L1 bridge (using the event that was emitted when calling initWormhole) to finalize the withdrawal via the wormhole router.  1600\u00d71047 175 KB  Figure 1: L2 \u2192 L1 Fast withdrawal  L2 <> L2 teleportation Walking through the steps of the fast path of the teleportation workflow from L2A to L2B:  User submits a teleportation request to the L2A DAI bridge (initiateWormhole) to withdraw 100 DAI. DAI on L2A is burnt. User gets an attestation that they burnt DAI and requested a fast withdrawal to L1 (off-chain oracle) User provides attestation to WormholeOracleAuth contract on L2B that verifies that their attestation is correctly signed by the Maker Oracle Feed. User mints 100 DAI on L2B as long as the L2B debt ceiling is not reached. The debt outstanding to be repaid is 100 DAI Periodically, a keeper calls Flush on L2 DAI bridge which sends a L2->L1 message to release the DAI from the L2A bridge contract on L1 to the L2B bridge contract on L1 via the wormhole router Similarly to a deposit, DAI is now locked in L2B bridge on L1, DAI is minted on L2B and used to pay back the debt on L2B  Similarly to the fast withdrawal workflow, in case of oracle failure, the user can go through the slow path by directly calling the L1 bridge. The slow path timing depends on the L2. For Starknet it will be at maximum a few hours.  1600\u00d7689 145 KB  Figure 2: L2 <> L2 teleportation  Starknet wormhole implementation  Roadmap  1600\u00d7784 86.9 KB  The Starknet implementation will be done in parallel of the PECU\u2019s implementation on EVM-compatible chains. The PECU, Oracles CU, Risk CU, and SECU will collaborate on the technical implementations as well as the risk parameters definition for each domain. The wormholing requires the MCD Vat and other related contracts to be built on L2, which prepares for phase III (minting on L2 with collateral). Maker will benefit from building the wormhole design on two L2s in parallel to realize the value promised by the design and for end-to-end tests purposes.  Important differences between Starknet and ORs This section focuses on the differences between ORs and Starknet that may introduce wormhole implementation specificities. State update frequency: Starknet state update frequency on L1 is currently every few hours. The update frequency should be reduced to less than an hour towards the end of 2022. Optimistic rollups typically have a one week period before a state update is final. The main difference in user experience is that the slow path in the fast withdrawal flow would be much faster with Starknet than with other rollups. Trusted Finality: With ORs, provided the existence of verifiers (and existence of the fraud proof mechanism), all the transactions present in the canonical transaction chain (CTC) are included with 100% certainty in the next state update. Hence, in that scenario, a non-malicious and non-corrupted oracle reading from the CTC can provide attestations with 100% reliability that a wormhole request will be included in the next state update. Note that Optimism for example does not have fraud proofs implemented at the moment, hence the statement above does not hold true yet. With Starknet, the transactions are final only when they are submitted to L1. However, mechanisms are being developed by Starkware to assure that a transaction will be included with certainty in the next batch, assuming that the sequencer(s) are rational agents. We refer to this method as \u201ccheckpoints\u201d, and involves sequencers posting collateral and committing to a sequence of transactions to include in each next batch. Decentralization: Starknet is planning on starting the implementation of its decentralization plan before Q3 2022. Anyone could then become a sequencer. The decentralization plans of different ORs vary yet are less aggressive than that of Starknet.  Risk management  Risk of minting unbacked DAI In the wormhole context, minting unbacked DAI means minting DAI from a wormhole vault such that the underlying debt will not be repaid. In such an event, MKR holders would directly be hurt because the debt would be queued as bad debt. There are two main risk factors that could lead to minting unbacked DAI: Malicious oracle: If a malicious oracle provides a false attestation, the user could mint DAI out of thin air from a custom vault which won\u2019t see its debt repaid. The oracles are reading directly from L2 nodes, they are not providing signed prices from exchanges like the price oracle. Trusted Finality and malicious sequencer(s): Transactions on StarkNet are considered final only when a proof attesting their correctness is published on L1, and the state is updated. However, waiting until a proof is published on L1 for the fast withdrawal (or teleportation) defeats the purpose as the user could just perform a regular request within this timeframe. This means that the Oracle is exposed to attack from StarkNet\u2019s sequencer ( and after decentralization - sequencers) where the sequencer(s) would \u201clie\u201d to the Oracle about some fast withdrawal request that they are about to include. After the Oracle provides the attestation to the user, the sequencer(s) would exclude the request from the stream of transactions they are actually proving, practically executing a double spend attack.  Risk of unacceptable user experience The wormhole users have expectations of a fast and seamless experience. Providing an experience that\u2019s worse than the regular withdrawals is a reputational risk for Maker. Censorship and oracle failure are the main risk factors here. Oracle infrastructure: In case oracles are down (or maliciously non-responsive to a single user), users would not be able to fast withdraw (or teleport) at all. The slow path being more cumbersome that the normal path (without wormhole), it would make for a very negative user experience. Censorship by StarkNet Sequencer(s): In case the user isn\u2019t able to push their request (or subsequent calls) as a StarkNet transaction due to being censored by StarkNet\u2019s sequencer(s). The censorship risk exists for the following calls: initiateWormhole (on source domain), mint (on target domain), flush (on source domain), settle (on target domain).  Risk remediation  Starknet risk remediation Starknet is bound to evolve over the next year. Upgrades mitigating the risks mentioned in the section above are being planned. Fast Finality: StarkWare is currently working on guaranteeing an intermediate-level of finality that would be established a few minutes after the transaction is received. The design is still being discussed, but for example it could rely on high economic incentives to the sequencer to prove the sequence of txs it committed to (other mechanisms in addition/instead this example are considered as well). Such kind of enforcement will make the double-spend attack by the sequencer irrational for reasonable amounts of DAI transfers. This feature is expected within 6-9 months. Decentralization: Within 9 months StarkNet is planning to be fully decentralized, meaning that anyone (including the censored user) could become the sequencer - eliminating the censorship risk and its associated negative impact on the user experience.  MakerDAO risk remediation This list of risk remediation is not exhaustive. The Risk CU will work with PECU, Oracles CU, and Starknet Engineering CU to define risk parameters for each wormhole domain. Oracles redundancy: Oracles failure being the most important risk factor, for each rollup multiple oracles will read from multiple nodes with a different underlying infrastructure (different providers and methodologies), hence reducing the single-point of failure risk. Wormhole source domain ceiling: The maximum amount of DAI that can be minted based on an oracle attestation from the source domain. This ceiling directly caps the risk of an oracle providing a false attestation on a given domain. Wormhole debt ceiling: The maximum amount of DAI that can be minted on Ethereum domain. It represents the amount of DAI that can be used at the same time for fast withdrawal L2->L1 purpose. DAI bridge limit: Like for other domains, the Starknet bridge will have a DAI bridge limit defined by the Risk CU. DAI bridge limit represents the maximum amount of DAI in the official bridge (i.e., in the L1 escrow contract). If Starknet was to go down, it is the maximum amount of DAI that MakerDAO would need to redistribute to users on L1 through the exit mechanism. ",
                    "links": [
                        "https://forum.makerdao.com/t/introducing-maker-wormhole/11550",
                        "https://forum.makerdao.com/t/mip39c2-sp19-adding-the-starknet-engineering-core-unit-sne-001/9745",
                        "https://github.com/makerdao/starknet-dai-bridge",
                        "https://chainsecurity.com/security-audit/makerdao-starknet-dai-bridge/",
                        "https://forum.makerdao.com/t/mip40c3-spxx-starknet-wormhole-implementation/12041",
                        "https://github.com/makerdao/starknet-dai-bridge",
                        "https://chainsecurity.com/security-audit/makerdao-starknet-dai-bridge/",
                        "https://forum.makerdao.com/t/mip40c3-spxx-starknet-wormhole-implementation/12041",
                        "https://forum.makerdao.com/t/introducing-maker-wormhole/11550",
                        "https://forum.makerdao.com/t/a-multichain-strategy-and-roadmap-for-maker/8380",
                        "https://forum.makerdao.com/t/introducing-maker-wormhole/11550",
                        "https://forum.makerdao.com/t/mip40c3-spxx-starknet-wormhole-implementation/12041",
                        "https://forum.makerdao.com/t/introducing-maker-wormhole/11550",
                        "https://forum.makerdao.com/t/forum-at-a-glance-december-2-9-2021/12119",
                        "https://forum.makerdao.com/t/mip40c3-sp79-mkr-compensation-for-starkenet-engineering-core-unit-sne-001/17042/33",
                        "https://forum.makerdao.com/t/mip40c3-sp47-core-unit-budget-sne-001-phase-ii-starknet-fast-withdrawal-and-wormhole/12041",
                        "https://forum.makerdao.com/t/mip40c3-sp79-mkr-compensation-for-starknet-engineering-core-unit-sne-001/17042",
                        "https://forum.makerdao.com/t/under-construction/12274/14"
                    ],
                    "GPT-summary": null,
                    "GPT-proposal-categories": null,
                    "GPT-discussion-categories": null,
                    "Sentiment": 5.3050816343155045
                },
                {
                    "author_link": "https://forum.makerdao.com/u/flipflopflapdelegate",
                    "index": "#2",
                    "likes": "1",
                    "time": "07/12/2021-13:48:09",
                    "content": "Quick simple question? Is this wormhole also compatible with StarkEx implementations like dYdX, or if I wanted to buy an NFT with DAI on ImmutableX?     pyramidmaker:  The design is still being discussed, but for example it could rely on high economic incentives to the sequencer to prove the sequence of txs it committed to (other mechanisms in addition/instead this example are considered as well).   Is this design similar to what dYdX was using/uses where they use a central liquidity provider to basically front the withdrawals from the system? They are basically fronting the withdrawals. ",
                    "links": [],
                    "GPT-discussion-categories": null,
                    "Sentiment": 5.405952380952382
                },
                {
                    "author_link": "https://forum.makerdao.com/u/Ohad_Barta_StarkWare",
                    "index": "#3",
                    "likes": "2",
                    "time": "07/12/2021-14:09:52",
                    "content": "Hi @flipflopflapdelegate , regarding the second question - dYdX situation is very different, as they are currently the sole sequencer of the transactions in their system, and thus the fast withdrawal design there assumes trust between dYdX and the LP. Thus, in the fast withdrawal there, the LP gives money to the user and then can get money from the user on L2, but  there is no \u201cmechanism\u201d that forces dYdX to include this transfer of money from the user to the LP , compensating it on the money given to the user on L1. Since StarkNet is (soon-ish to be) decentralized we can\u2019t make the assumption that there is trust between LP and StarkNet\u2019s sequencer, so we analyze more carefully the risk of the LP (Maker, in this case) giving his money on L1 but doesn\u2019t get compensation on L2. This involves answering questions like \u201chow/when an LP can be sure he would get his money on L2\u201d (without waiting for a proof). The paragraph you quoted is a potential answer to that. Makes sense? ",
                    "links": [],
                    "GPT-discussion-categories": null,
                    "Sentiment": 5.6499999999999995
                },
                {
                    "author_link": "https://forum.makerdao.com/u/flipflopflapdelegate",
                    "index": "#4",
                    "likes": "2",
                    "time": "07/12/2021-14:24:45",
                    "content": "Got it. So, relying on the high economic incentive to the sequencer should help with the end-user product experience. Understood. Thank you. ",
                    "links": [],
                    "GPT-discussion-categories": null,
                    "Sentiment": 5.8999999999999995
                },
                {
                    "author_link": "https://forum.makerdao.com/u/system",
                    "index": "#5",
                    "likes": "0",
                    "time": "07/03/2022-14:25:08",
                    "content": "This topic was automatically closed 90 days after the last reply. New replies are no longer allowed. ",
                    "links": [],
                    "GPT-discussion-categories": null,
                    "Sentiment": 5.0606060606060606
                }
            ]
        }
    ]
}