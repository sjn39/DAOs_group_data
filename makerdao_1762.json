{
    "poll_list": [],
    "discourse_list": [
        {
            "thread_link": "https://forum.makerdao.com/t/postmortem-tecnico-de-la-vulnerabilidad-de-manipulacion-de-tokens-curve-lp-traduccion/18038",
            "title": "Postmortem T\\xc3\\xa9cnico de la Vulnerabilidad de Manipulaci\\xc3\\xb3n de Tokens Curve LP [Traducci\\xc3\\xb3n] ",
            "index": 18038,
            "category": [
                "Latin America"
            ],
            "tags": [
                "espa\\xc3\\xb1ol",
                "latin-america",
                "translate"
            ],
            "content": [
                {
                    "author_link": "https://forum.makerdao.com/u/cryptenthusiastic",
                    "index": "#1",
                    "likes": "5",
                    "time": "22/09/2022-03:28:19",
                    "content": "Inicio: 2022-03-14 14:00:35 UTC Finalizaci\u00f3n: 2022-04-27 14:00:37 UTC Autores: Kurt Barry (kmbarry1) Estado: Resuelto Resumen: El 14 de abril de 2022, el equipo de Curve contact\u00f3 y alert\u00f3 a la Core Unit de Ingenier\u00eda de Protocolos (PECU) de MakerDAO sobre una vulnerabilidad en nuestro or\u00e1culo steCRV (pool de ETH-stETH) debido a una manipulaci\u00f3n de reentrada del pool de Curve subyacente. En concreto, el valor devuelto por get_virtual_price() ser\u00eda err\u00f3neamente alto si se llamara durante una retirada del pool de Curve. Dado que el or\u00e1culo depende de get_virtual_price(), el ataque implicar\u00eda llamar a poke() en el or\u00e1culo durante la retirada (provocada por la transferencia de ETH en bruto a la direcci\u00f3n del destinatario). Las core units de MakerDAO y los delegados de voto se coordinaron para congelar los or\u00e1culos y asegurarse de que no se produjera el ataque. A continuaci\u00f3n, se desarroll\u00f3 una soluci\u00f3n para el or\u00e1culo y se incluy\u00f3 en la propuesta ejecutiva del 22 de abril de 2022, que se ejecut\u00f3 el 27 de abril de 2022, volviendo a habilitar la funcionalidad completa de la garant\u00eda CRVV1ETHSTETH-A. La respuesta al incidente se examina en un postmortem separado; este documento se centra en los procesos que permitieron que una vulnerabilidad entrara en el sistema de producci\u00f3n y permaneciera sin detectar durante varias semanas. Impacto: Perturbaci\u00f3n significativa para las partes interesadas de MakerDAO, y desv\u00edo de recursos del trabajo planificado a la respuesta y mitigaci\u00f3n del incidente. Adem\u00e1s, los titulares de las Vaults CRVV1ETHSTETH-A experimentaron una funcionalidad degradada durante casi dos semanas (no pod\u00edan extraer deuda adicional, no pod\u00edan retirar garant\u00edas sin reembolsar toda la deuda). Causas fundamentales: La causa principal fue el escrutinio insuficiente de un contrato externo que se integraba con los componentes de Maker. Las razones de este escrutinio insuficiente se detallan a continuaci\u00f3n.  Largo historial del contrato integrado y m\u00e9todo de integraci\u00f3n (\u201cLindyness\u201d). Los pools de Curve se utilizan desde hace mucho tiempo, y el propio pool de ETH-stETH no es especialmente nuevo. Adem\u00e1s, el uso de get_virtual_price() para valorar los tokens del or\u00e1culo Curve LP segu\u00eda exactamente el mismo patr\u00f3n utilizado por otros proyectos (por ejemplo, Alpha Finance, Rari Capital), y esas implementaciones existentes no hab\u00edan experimentado hacks en su tiempo en mainnet. Esto contribuy\u00f3 a un alto nivel de confianza en la seguridad de la implementaci\u00f3n, que en retrospectiva era injustificada. Limitaciones generales de recursos. La implementaci\u00f3n del or\u00e1culo fue sometida a las habituales pruebas unitarias y de integraci\u00f3n, a m\u00faltiples revisiones internas del c\u00f3digo y a una auditor\u00eda, pero ninguno de estos esfuerzos profundiz\u00f3 en el c\u00f3digo de Curve, que en s\u00ed mismo no era trivial. Para ello se habr\u00edan necesitado recursos adicionales, que ya estaban asignados a otras cosas.  Por supuesto, la investigaci\u00f3n de integraciones complejas en profundidad debe equilibrarse con la secuencia de ejecuci\u00f3n deseada. En este caso, el c\u00f3digo de Curve pool era probablemente lo suficientemente sencillo como para que esto no hubiera sido descabellado, aunque s\u00ed costoso. Los miembros del equipo de PECU hab\u00edan estudiado previamente algunos aspectos del c\u00f3digo de Curve, en particular la implementaci\u00f3n matem\u00e1tica, con cierto detalle; esto contribuy\u00f3 a un alto nivel de confianza que pas\u00f3 por alto los aspectos \u00fanicos del pool steCRV (manejo de Ether crudo). Esto podr\u00eda haberse descubierto utilizando herramientas automatizadas o una lista de comprobaci\u00f3n de la integraci\u00f3n que podr\u00eda se\u00f1alar un problema de seguridad com\u00fan como el env\u00edo de Ether crudo de forma proactiva. Desencadenante: Implementaci\u00f3n vulnerable del or\u00e1culo desplegada en producci\u00f3n. Soluci\u00f3n: Se ha integrado en el protocolo Maker un or\u00e1culo corregido con una funci\u00f3n poke() que revierte si se intenta la reentrada desde el pool de Curve, volviendo a habilitar de forma segura el tipo de garant\u00eda CRVV1ETHSTETH-A. Detecci\u00f3n: ChainSecurity encontr\u00f3 un problema similar en un c\u00f3digo no relacionado, lo que les llev\u00f3 a buscar problemas an\u00e1logos en contratos inteligentes previamente auditados. Encontraron dichos fallos en ciertos pools de Curve y lo notificaron al equipo de Curve, con el que luego colaboraron para realizar revelaciones a otros proyectos, incluido MakerDAO. Acciones a realizar:     Accion a realizar Tipo Due\u00f1o (GH handle) Ticket     Definir heur\u00edstica y/o listas de comprobaci\u00f3n para cuando las integraciones externas requieran un estudio m\u00e1s profundo Prevenir kmbarry1 1088    Investigar la detecci\u00f3n generalizada, automatizada de las vulnerabilidades de integraci\u00f3n Prevenir kmbarry1 1090   Definir directrices sobre la rapidez de los aumentos del techo de la deuda en funci\u00f3n del riesgo t\u00e9cnico Gesti\u00f3n del riesgo godsflaw 1089     Lecciones aprendidas Lo que ha ido bien:  El problema se descubri\u00f3 y se mitig\u00f3 antes de su explotaci\u00f3n. El proceso de aumento gradual del techo de la deuda hizo que la gravedad potencial fuera limitada. La vulnerabilidad se notific\u00f3 un d\u00eda antes de que saliera un ejecutivo que habr\u00eda aumentado el techo de deuda de 5 millones a 50 millones de DAI, por lo que fue muy oportuno (y afortunado). Se desarroll\u00f3 una soluci\u00f3n aceptable y se despleg\u00f3 r\u00e1pidamente.  Lo que sali\u00f3 mal:  La revisi\u00f3n interna, las pruebas y las auditor\u00edas no detectaron la vulnerabilidad. La evaluaci\u00f3n del equipo sobre la necesidad de auditar la integraci\u00f3n con mayor profundidad (baja) fue inconsistente con la necesidad real (alta). El importante peligro que supone la manipulaci\u00f3n del or\u00e1culo, junto con el uso de un antipatr\u00f3n de seguridad (manejo de ETH en bruto) por parte del contrato integrado, deber\u00eda haber se\u00f1alado que se trataba de una integraci\u00f3n arriesgada que requer\u00eda un escrutinio m\u00e1s cuidadoso.   L\u00ednea de tiempo Todas las horas UTC. Ver el postmortem de la respuesta al incidente para una l\u00ednea de tiempo m\u00e1s detallada despu\u00e9s de la detecci\u00f3n. 2022-03-14 14:00:35: CRVV1ETHSTETH-A se integra con el or\u00e1culo vulnerable. 2022-04-14 17:15: Michael Egorov de Curve notifica a godsflaw la vulnerabilidad. 2022-04-14 22:27:38: El or\u00e1culo CRVV1ETHSTETH-A es congelado por un spell ejecutivo fuera de banda. 2022-04-18 22:04: Se completa la correcci\u00f3n tentativa para el or\u00e1culo y se comparte con un subconjunto de miembros del equipo PECU para su revisi\u00f3n. 2022-04-19: Se descubre una forma superior de evitar la reentrada (remove_liquidity en lugar de withdraw_admin_fees). 2022-04-25 13:02:07: Se programa la ejecuci\u00f3n del spell para reemplazar el or\u00e1culo vulnerable. 2022-04-27 14:00:37: spell que integra el or\u00e1culo arreglado es cast.  Informaci\u00f3n de apoyo Confirmar el error y su correcci\u00f3n   Esta es una traducci\u00f3n libre del topic Curve LP Token Oracle Manipulation Vulnerability Technical Postmortem de @Kurt_Barry Cr\u00e9ditos: Traducci\u00f3n @cryptenthusiastic - Revisi\u00f3n @FuchoCrypto ",
                    "links": [
                        "https://forum.makerdao.com/t/curve-lp-token-oracle-manipulation-vulnerability-emergency-response-postmortem/18011",
                        "https://github.com/makerdao/smart-contracts-team-pm/issues/1088",
                        "https://github.com/makerdao/smart-contracts-team-pm/issues/1090",
                        "https://github.com/makerdao/smart-contracts-team-pm/issues/1089",
                        "https://github.com/makerdao/curve-lp-oracle/commit/302f5e6966fdbfebe0f7063c9d6f6bc1f6470f28",
                        "https://forum.makerdao.com/t/curve-lp-token-oracle-manipulation-vulnerability-technical-postmortem/18009"
                    ],
                    "GPT-summary": null,
                    "GPT-proposal-categories": null,
                    "GPT-discussion-categories": null,
                    "Sentiment": 4.729166666666666
                },
                {
                    "author_link": "https://forum.makerdao.com/u/cryptenthusiastic",
                    "index": "#2",
                    "likes": "1",
                    "time": "22/09/2022-03:31:42",
                    "content": "    cryptenthusiastic:  Detecci\u00f3n: ChainSecurity encontr\u00f3 un problema similar en un c\u00f3digo no relacionado, lo que les llev\u00f3 a buscar problemas an\u00e1logos en contratos inteligentes previamente auditados. Encontraron dichos fallos en ciertos pools de Curve y lo notificaron al equipo de Curve, con el que luego colaboraron para realizar revelaciones a otros proyectos, incluido MakerDAO.   Por cierto, que buena accion la de ChainSecurity ",
                    "links": [],
                    "GPT-discussion-categories": null,
                    "Sentiment": 5.0
                }
            ]
        }
    ]
}