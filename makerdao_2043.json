{
    "poll_list": [],
    "discourse_list": [
        {
            "thread_link": "https://forum.makerdao.com/t/6-7-december-2023-forum-issues-postmortem/19252",
            "title": "6-7 December 2023 Forum issues Postmortem ",
            "index": 19252,
            "category": [
                "Core Units",
                "TechOps"
            ],
            "tags": [
                "tech-001",
                "forum"
            ],
            "content": [
                {
                    "author_link": "https://forum.makerdao.com/u/dumitru",
                    "index": "#1",
                    "likes": "5",
                    "time": "23/12/2022-15:35:35",
                    "content": "Date // 2022.12.06 Authors // Simon / Dumitru / Artautas Status // resolved on 2022.12.07  Summary TechOps CU was notified by the community members that some pages of the forum are not available most of the time on mobile devices and intermittently on desktop. Global TechOps team were able to jump on the issue and eventually resolve the problem via a combination of upgrading to a new version of the forum (after speaking to their devs) and removing the CloudFlare component from the infrastructure stack.  Impact  Community members are not able to reach forum Issue when trying to access the forum when logged in Issues with reaching forum via desktop Issues with reaching forum via mobile Issues with forum is unpredictable: for the same person it works and suddenly stops working and resumes working after some time   Root Causes  Currently not clear - but biggest suspicion is that combination of infrastructure setup being incompatible with one of the upgraded versions of the forum. Discourse software version release somewhere between beta10 or 12 got broken The backup restore started working from the below Discourse version   1600\u00d7159 75.5 KB   Potential issue with CloudFlare being in the mix   Trigger  Accessing from mobile And intermittently from a desktop browser   Resolution  Various troubleshooting techniques to help identify the problem  Adjusting various Forum settings Trying to reproduce the problem on Staging Trying various combinations of Forum components - nginx, PostgresQL   Restoring previous backups one by one to identify where the fault was introduced Speaking to Discourse developers by opening a thread on their forums Version 2.9.0.beta14 - Forum's home won't load on mobile - bug - Discourse Meta  Upgrading to the version with the latest changes done on 2nd, 3rd, 5th and 6th of December - didn\u2019t help, still not accessible from mobile phone Disabled (commented on the lines) all third party plugins from production instance and rebuilding the app - didn\u2019t help, still not accessible from mobile phone Rolling back to previous beta 10 version (https://new-forum.makerdao.com/ - it is disabled now) - didn\u2019t help, still not accessible from mobile phone Eventually upgrading to the latest Discourse version Removing Cloudflare from the mix   Detection  Users alerting TechOps CU via Discord channel of pages not being available 7 December - morning UTC time - Plugins re-added and forum app rebuilt. Community notified TechOps CU that the forum is experiencing issues on 30/11/2022. TechOps started working on it. We received notifications from community members via discord  and started working on this issue ASAP. Also we have been providing updates in community channel: #techops-public. Internal Jira ticket was created on December 2nd.   Action Items  Terraform manually created prod Load balancer and target group Stop new-forum clone and its Load balancer Get staging environment in exactly the same state as production and always upgrade and test that first  Staging forums do not have live traffic which means upgrading staging may not represent the full image of what the Prod environment could be. We could test all the basic functions like if the forum is up and running in the new version on both desktop and mobile. And whether we can make a post, reply and etc. once the test has been completed successfully; we can move on to the prod upgrade.   Destroy all the manually created test Forum infrastructure that was used during diagnosing Potentially re-add CloudFlare to the infrastructure stack Investigate the hosted Discourse version Regular dump of forum content and hosted with a different provider to increase availability Decoupling forum components for increased availability and improvising the deployment stack Dedicated separate database - RDS, to have possibility to restore data at any point in time.   Lessons Learned  What went well  Logged a ticket with Discourse community at the early stage of our issue Responsive and helpful Discourse devs Global TechOps team working together handling tasks off at the end of their day Regular updates from TechOps to community   What went wrong  Tricky issue to diagnose due to its intermittent nature   Where we got lucky  The community members alerted TechOps of the issues quite promptly Eventually found a version that worked after we kept trying with the backup restore on staging Forum was still mostly accessible on desktop   Supporting information  Users data  1115\u00d7417 34.9 KB  December 1 seems to be when most users tried accessing the forum, but couldn\u2019t log in or probably tried incognito mode.  1148\u00d7261 24.3 KB  Increased crawler traffic since CloudFlare was removed from the infrastructure. TechOps will investigate if it should be readded. We are already testing the better setup that will protect forum from crawlers as well as keep the optimized setup running smoothly.  Performance monitoring Forum performance between December 1-8  1044\u00d7261 13.8 KB  Response time between December 1-8  1052\u00d7205 14.6 KB  With many users not being able to access the forum from mobile devices, response time decreased and the forum was loading faster for those who were able to use it.  Infrastructural changes done while debugging  1146\u00d7791 51.2 KB   Statuspage overview  During two days, due to all maintenance work that we\u2019ve been doing on forum to resolve the issues, the forum has been partly inaccessible. Overall forum uptime has been around 99.89% in the last 90 days and over 99.99% in the last 180 days.  Community tickets There were two tickets created by community members for TechOps team to have a backup solution for the forum as well as read-only access to forum posts whenever there are major incidents with the forum. As it was mentioned in the \u201cAction Items\u201d section, we are looking into improving setup that would solve two above-mentioned requests. ",
                    "links": [
                        "https://new-forum.makerdao.com/",
                        "https://discord.com/channels/893112320329396265/935222937785597992/1047935344697409566",
                        "https://forum.makerdao.com/t/forum-maintenance-announcement-4-january-2023-945-utc/19292",
                        "https://forum.makerdao.com/t/techops-core-unit-updates-december-2022/19564"
                    ],
                    "GPT-summary": null,
                    "GPT-proposal-categories": null,
                    "GPT-discussion-categories": null,
                    "Sentiment": 5.378263403263404
                }
            ]
        }
    ]
}