{
    "poll_list": [],
    "discourse_list": [
        {
            "thread_link": "https://forum.makerdao.com/t/bridge-hacks-review-and-learnings-for-maker-teleport/17549",
            "title": "Bridge hacks review and learnings for Maker teleport ",
            "index": 17549,
            "category": [
                "Core Units",
                "StarkNet Engineering"
            ],
            "tags": [
                "risk",
                "protocol-engineering",
                "sne-001"
            ],
            "content": [
                {
                    "author_link": "https://forum.makerdao.com/u/pyramidmaker",
                    "index": "#1",
                    "likes": "16",
                    "time": "31/08/2022-08:30:22",
                    "content": " Paragraph summary @Protocol-Engineering and @starknet-core-unit reviewed the top 9 bridge hacks for a cumulated amount of $2Bn. The goal of this post is to summarize learnings from common patterns across the hacks, and derive potential improvements around rollup due diligence, bridge design, and additional risk parameters. Concrete next steps are proposed at the end of this document to incorporate the learnings of this analysis. The bridge hacks that have been reviewed are bridge hacks only. Protocol hacks that do not involve bridges are not included. The hacks reviewed were: Ronin ($624Mn), Poly ($611Mn), Solana wormhole ($326Mn), Nomad ($190Mn), Harmony ($97Mn), Qubit ($90Mn), ThorChain($5Mn), Meter ($4,4Mn), and Chainswap ($4.4Mn). See spreadsheet for full notes on the hacks. There were two primary reasons for hacks so far: smart contract bugs and improper management of Validator\u2019s keys used to validate bridge transactions. Interestingly enough, so far, we have not experienced hacks related to failed security assumptions of Rollups (at least one honest validator in case of Optimistic Rollups and sound cryptography in case of zkRollups). That\u2019s not to say that Rollups are immune to hacks, it is more likely that there are easier hacks to perform on simpler externally-validated bridges.  Hack overview   Smart contract bug: Bug in a smart contract implementation that - presumably - was transparent and audited  Underlying blockchain implementation bug: Bug in an implementation of a chain full node, official libraries such as JSON-RPC, etc\u2026  Offchain infrastructure bug: Bug in a critical off-chain infrastructure, typically non-transparent and non-audited  Crypto key exploit: For any system component that is managed by MultiSig (typically upgrade key or bridge external validator), some keys were compromised  Key security risk assumption failure: Any system has one or more security assumptions, for example, 51% honest validators, at least one honest validator in DAC, not a single honest validator for Optimistic Rollup, etc\u2026   948\u00d7550 147 KB   Learnings  Rollup due diligence Lack of decentralization in different contexts. Lack of decentralization has led to hacks for example in the Ronin case where there was not enough validators. Ronin is a L1, not a rollup, yet the validators consensus could be similarly compromised on a rollup, but leading to different consequences. L2Beat is currently tracking the level of decentralization of each rollup Maker works with (Optimism, Arbitrum One, Arbitrum Nova, StarkNet). Lack of decentralization of the cross-chain messenging infrastructure also led to hacks. In the Harmony hack, the bridge was controlled by a 2/5 multi-sig wallet. Bridges using multi-sig messaging infrastructure are less relevant to Maker given the design choice we made around censorship resistance. However, Maker can be indirectly impacted by the existence of those bridges if canonical DAI is present on a rollup that has a high exposure to bridges built on a multi-sig messaging infrastructure. L2Beat intends to track the current setup and security assumptions for bridges that are used to move assets to sidechains/alt-L1s, hence assessing this risk exposure for Maker. Other potential exploits related to the lack of decentralization that have not been the source of a previous hack do exist (e.g., reliance on optimism to generate fraud proofs, single sequencer etc\u2026). L2Beat provides detailed information about those trust assumptions. Declaration of ad hoc design changes and procedures. In the Ronin case, they were facing a volume they could not handle on time and cost. AxieDAO setup a new sequencer and had SkyMavis sign on their behalf. SkyMavis was already operating 4 out of 9 sequencers and this ad hoc procedure made SkyMavis a single point of failure. All rollups, and potentially sidechains if we choose to work with them, should be obliged to report to Maker (and L2Beat) if they are introducing an ad hoc process changing the trust assumptions. In case a hack would stem from such a non-declared procedure, the rollup should bear a higher cost in implementing a recovery plan. Clarity around the access rules and management of critical pieces of infrastructure. For each rollup, it has not been identified clearly who can temper with each piece of critical infrastructure (e.g., sequencer, who can submit fraud proofs on optimism, what key controls the Starknet core contract). Those could be tracked by L2Beat to provide visibility on \u201cwhat would it take\u201d for someone internal to the rollup team to compromise critical pieces of the infrastructure.  Development and deployment processes The intent of this section is to highlight common points of failures across the nine hacks under review. This section might feel obvious to senior smart contract developers. Nothing can be deployed without prior audit. Audit needs to be on a relevant scope. There was no audit shared publicly for Poly, Nomad pushed an update that was not included in their audit and introduced the vulnerability, Harmony bridge was audited but auditors did not look into how the keys of the multi-sig contracts were managed, the Qubit team had audits covering different parts of the code but not an audit for the full scope, Meter was not audited. Audits cannot be done on a shortlist of functions. Audit needs to be as exhaustive as possible, and updates cannot be pushed without additional audit on a reasonable scope that will ensure authentication and verification is not compromised. Public github repo can leak critical information. In the Solana hack, a commit making a change to a critical function involved in the verification of guardians signature most likely pointed a hacker to the vulnerability. The hacker acted before the change was deployed. In the Thor hack, a comment was hinting at the vulnerability. We can assume that hacker groups have alerts and language processing running on all the public repo of bridges and protocols. It is a no brainer to be careful in commenting code and how to escalate the identification of a critical vulnerability. It is not obvious how to deal with critical patches because the mere fact that a critical component is being worked on is valuable information for a hacker. An option would be to have a way to work on critical patches in a non-public environment. System affecting authentication and verification. In the Poly and Chainswap cases, allowlists were not properly safeguarded. In the Solana case, the verification that an instruction came from the correct verified program was not properly performed. In the Nomad hack, the root was inadvertently (through an update) set to valid hence introducing a vulnerability. In the Qubit hack, the root was on the allowlist while it should not have been. It sounds obvious, but any updates or functions that might temper with authentication and verification needs to be managed with the highest level of precaution and an audit on a scope that is large enough needs to be performed before deploying. Limit ad hoc processes. It is hard to understand the intent without discussing in details with the respective teams, however thinking about design in a way to minimize ad hoc and backdoor processes would certainly improve the overall security. Nomad introduced the ability to \u201cstamp\u201d transactions that did not have to be in a valid merkle root. Thor introduced a retry mechanism for specific vault transfers. If those backdoors are absolutely necessary, they need to be audited frequently along with new features to not introduce vulnerabilities.  Conclusions and next steps  Risk parameters and circuit breaker implementation Given our distributed setup, we cannot rely on the PECU/SECU team to identify an exploit, investigate it, and synchronize with governance to trigger the circuit breaker in less than few hours. Yet the timelines are much shorter. For example, Nomad hack would have been partly mitigated if a circuit breaker would have been triggered within 30-60 mins. We find that in 100% of the hacks, combining a monitoring system with a circuit breaker and a daily volume limit would have limited the damages up to the daily limit. The circuit breaker and daily volume limit need to be implemented both for withdrawal (withdrawal circuit breaker, daily withdrawal limit) and minting on L2 (L2 mint circuit breaker, daily mint limit). The objective of the daily limit risk parameters is to control the losses and allow the governance team to trigger the circuit breaker within 24h. The workflow would be: i. monitoring indicates that we have an abnormal imbalance ii. PECU/SECU run a due diligence on the issue and notify governance iii. PECU/SECU confirms to governance it can trigger the circuit breaker within 24h Withdrawal limit: how much DAI can be withdrawn from the bridge escrow on a given domain per day, with a rolling 24h window Withdrawal circuit breaker: executed by governance, prevents any withdrawals from the domain L1 escrow L2 mint limit: how much DAI can be minted on a given domain per day, with a rolling 24h window L2 mint circuit breaker: executed by governance, prevents any further mint on L2 The circuit breaker as presented has obvious benefits and its design is relatively straightforward. However, there are still design discussions to be had internally to not compromise censorship-resistance.  Framework for an emergency plan   First off, let\u2019s look at the measures those projects took after their hack. They all executed a community communication plan within days to a week, and a recovery plan within weeks. Beyond fixing the bugs and re-auditing their bridge, one project has added an escrow withdrawal limit (Ronin), one has added a circuit breaker (Ronin), three have created or increased hack bounties (Poly, Solana, Qubit).   A learning from the Poly hack is that we can make the life of the hacker hard to launder the money. In that context, the regulatory troubles happening to the mixers can be seen as positive.   An emergency process document will be shared jointly with SECU and PECU, it has already been discussed with a rollup. The objectives of this document will be to define in advance processes to swiftly and efficiently react to a hack. It will include:  Process to identify the source of failure Process to swiftly execute a communication plan with partners involved and users Process to communicate with the hacker and execute of a fund recovery process Process to run due diligence on responsibilities and liabilities between parties (mostly protocol vs. rollups) Design principles for a recovery plan     Next steps  Discuss with L2Beat on including information about access and management to critical rollup infrastructure (e.g., sequencer, core contract) - @krzkaczor , @bartek , @Derek , @louismerkle  Share and discuss findings with PECU and SECU engineering team - @Protocol-Engineering , @starknet-core-unit  Design discussion for circuit breakers and daily limits, with a focus on censorship-resistance - @Protocol-Engineering , @starknet-core-unit  Prepare a draft emergency plan, to be discussed internally and with rollup teams. To be discussed on the forum regarding liability identification and potential user fund recovery plans - @Derek , @louismerkle  Review Immunefi bounty for the full teleport scope - @Derek , @louismerkle   credits to @bartek @0xevolve @maciejka @hexonaut @Derek cc: @Risk-Core-Unit @Recognized-Delegates ",
                    "links": [
                        "https://forum.makerdao.com/t/weekly-forum-recap/16247/23",
                        "https://forum.makerdao.com/t/circuit-breaker-trade-offs-and-questions-for-the-community/18240",
                        "https://forum.makerdao.com/t/pecu-month-in-review-august-2022/17941",
                        "https://forum.makerdao.com/t/mip40c3-sp79-mkr-compensation-for-starknet-engineering-core-unit-sne-001/17042",
                        "https://forum.makerdao.com/t/un-vistazo-al-foro-25-31-de-agosto-del-2022/17644",
                        "https://forum.makerdao.com/t/weekly-forum-recap/16247/14",
                        "https://forum.makerdao.com/t/revision-de-los-hacks-del-puente-y-aprendizajes-para-el-maker-teleport-traduccion/17571"
                    ],
                    "GPT-summary": null,
                    "GPT-proposal-categories": null,
                    "GPT-discussion-categories": null,
                    "Sentiment": 5.237054673721341
                },
                {
                    "author_link": "https://forum.makerdao.com/u/flipflopflapdelegate",
                    "index": "#2",
                    "likes": "1",
                    "time": "31/08/2022-08:46:59",
                    "content": "Thank you for posting this overview. Very informative and it shows how much more needs to be done. But personally, I\u2019m glad that a Maker Teleport Circuit Breaker has been implemented. I posted this write up on Discord about assessing Bridges by Joel John w/the help of Socket.tech \u2013 good read: Assessing Blockchain Bridges \u2014 Joel John BTW, I think you might have doubled Copy & Pasted \u2013 check the formatting again starting at:  image1506\u00d7382 83.2 KB  You posted that  twice  Looking forward to future findings of improvements. ",
                    "links": [],
                    "GPT-discussion-categories": null,
                    "Sentiment": 6.583333333333333
                },
                {
                    "author_link": "https://forum.makerdao.com/u/pyramidmaker",
                    "index": "#3",
                    "likes": "0",
                    "time": "31/08/2022-08:55:41",
                    "content": "thank you @flipflopflapdelegate , wrong copy paste in the forum editor indeed. Thanks for sharing the read by Socket ",
                    "links": [],
                    "GPT-discussion-categories": null,
                    "Sentiment": 4.25
                },
                {
                    "author_link": "https://forum.makerdao.com/u/system",
                    "index": "#4",
                    "likes": "0",
                    "time": "29/11/2022-08:56:30",
                    "content": "This topic was automatically closed 90 days after the last reply. New replies are no longer allowed. ",
                    "links": [],
                    "GPT-discussion-categories": null,
                    "Sentiment": 5.0606060606060606
                }
            ]
        }
    ]
}